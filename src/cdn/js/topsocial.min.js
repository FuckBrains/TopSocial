function appendToMasonry(a){$items=$(a),container.append($items),container.masonry("appended",$items)}function prependToMasonry(a){$items=$(a),container.prepend($items),container.masonry("prepended",$items)}function NeglectArrowKeys(a,b){return 37==b.keyCode?(b.preventDefault(),!1):38==b.keyCode?(b.preventDefault(),!1):39==b.keyCode?(b.preventDefault(),!1):40==b.keyCode?(b.preventDefault(),!1):16==b.keyCode?(b.preventDefault(),!1):17==b.keyCode?(b.preventDefault(),!1):18!=b.keyCode||(b.preventDefault(),!1)}function EnterKeyPressed(a,b){if(13==b.keyCode)return b.preventDefault(),!0}function EscapeKeyPressed(a,b){if(27==b.keyCode)return!0}function SuggestSearchItems(a,b,c,d){var e=$(a).data("search-url")+"/"+$(a).val();if(EnterKeyPressed(a,d)&&(window.location=e),0!=NeglectArrowKeys(a,d)){var f=$("[data-text-box='"+$(a).attr("id")+"']");if(EscapeKeyPressed(a,d))return void f.remove();0==$(a).val().trim().length&&f.remove(),$(a).val().length>0&&(ShowSearchSuggestionBox(a,b,c),AjaxGet(e,function(a){var b=JSON.parse(a);f.html(b.Response)}))}}function ShowSearchSuggestionBox(a,b,c){if(loadedSearchResult=$("[data-text-box='"+$(a).attr("id")+"']"),0==loadedSearchResult.length){var d="<div class='search-suggestion-box hide-on-outside-click "+c+"' data-text-box='"+$(a).attr("id")+"'><div class='loading-circle'></div></div>";void 0!=b?$(b).append(d):$(a).after(d)}else loadedSearchResult.append("<div class='loading-circle'></div>")}function carouselNormalization(a){function b(){d.each(function(){e.push($(this).height())}),c=Math.max.apply(null,e),d.each(function(){$(this).css("min-height",c+"px")})}var c,d=$(a).find(".item"),e=[];d.length&&(b(),$(window).on("resize orientationchange",function(){c=0,e.length=0,d.each(function(){$(this).css("min-height","0")}),b()}))}function ResizeCarouselAccordingtoContent(a){var b=0;$(a).find(".item").each(function(a,c){var d=$(c).height();d>b&&(b=d)}),$(a).find(".carousel-inner").height(b)}function AjaxGet(a,b){$.ajax({url:a,error:function(a,b,c,d){console.log(a),ErrorDandler(a,b,c,d)},success:function(a){b(a)},type:"GET"})}function RedirectTo(a,b,c){""==a?window.location.replace("/Account/Login"):c?window.open(a.url,"_blank"):window.location.replace(a.url)}function MessageAndRedirectTo(a,b,c){a.success&&(ModalApear(a.message,"success"),setTimeout(function(){RedirectTo(a,b,c)},4e3))}function ErrorDandler(a,b,c,d){if(400==a.status){var e=JSON.parse(a.responseText).Errors;$(d).find("span[data-valmsg-for]").text("").removeClass("field-validation-error").addClass("field-validation-valid"),$.each(e,function(a,b){$(d).find("span[data-valmsg-for='"+b.Key+"']").text(b.Message).removeClass("field-validation-valid").addClass("field-validation-error")})}else{var f=JSON.parse(a.responseText);Alert(f.message,"error")}}function loadFollowing(){function a(a){appendToMasonry(a.Response),next_data_url=a.Next_data_url,next_data_cache=!1,""!=next_data_url&&$.getJSON(next_data_url,function(a){next_data_cache=a})}""==next_data_url.trim()||(is_loading=1,next_data_cache?(a(next_data_cache),is_loading=0):$.getJSON(next_data_url,function(b){a(b),is_loading=0}))}function loadPrevious(){function a(a){var b=$("div.scrollinglistitem:first");prependToMasonry(a.Response);var c=b.data("page");item_height=$("div.scrollinglistitem[data-page='"+c+"']:last").scrollTop()-$("div.scrollinglistitem[data-page='"+c+"']:first").scrollTop(),window.scrollTo(0,$(window).scrollTop()+item_height),prev_data_url=a.Prev_data_url,prev_data_cache=!1,""!=prev_data_url&&$.getJSON(prev_data_url,function(a){prev_data_cache=a}),hide_on_load&&($(hide_on_load).hide(),hide_on_load=!1)}""==prev_data_url||(is_loading=1,prev_data_cache?(a(prev_data_cache),is_loading=0):$.getJSON(prev_data_url,function(b){a(b),is_loading=0}))}function mostlyVisible(a){var b=$(window).scrollTop(),c=$(window).height(),d=$(a).offset().top,e=$(a).height(),f=d+e;return f-.25*e>b&&d<b+.5*c}function initPaginator(){$(window).scroll(function(){var a=$(window).scrollTop();a>=.9*($(document).height()-$(window).height())&&0==is_loading&&loadFollowing(),a<=.9*$(".page-start:first").offset().top&&0==is_loading&&loadPrevious(),Math.abs(a-last_scroll)>.1*$(window).height()&&(last_scroll=a,$(".page-start").each(function(a,b){if(mostlyVisible(b))return history.replaceState(null,null,$(b).data("page-url")),!1}))}),$(document).ready(function(){if($(window).height()>$(".scrollingcontent").height())if(""!=next_data_url.trim())loadFollowing();else{var a=document.createElement("div");a.id="filler",a.style.height=$(window).height()-$(".scrollingcontent").height()+"px",$(".scrollingcontent").after(a),hide_on_load="filler"}})}function primeCache(){""!=prev_data_url.trim()&&$.getJSON(prev_data_url,function(a){prev_data_cache=a}),""!=next_data_url.trim()&&$.getJSON(next_data_url,function(a){next_data_cache=a})}var container=$("#posts");container.masonry({gutter:".gutter-sizer",itemSelector:".post",columnWidth:".column-sizer",percentPosition:!0}),$(document).ready(function(){var a=$("#jquery_jplayer_1").data("video-url");$("#jquery_jplayer_1").jPlayer({ready:function(b){$(this).jPlayer("setMedia",{m4v:a})},swfPath:"http://jplayer.org/latest/dist/jplayer",supplied:"m4v",wmode:"window",useStateClassSkin:!0,autoBlur:!1,smoothPlayBar:!0,keyEnabled:!0,remainingDuration:!0,toggleDuration:!0}),$(".bootstrap-carousel").carousel({}),$(".bootstrap-carousel-lazy").on("slide.bs.carousel",function(a){var b=$(a.target),c=b.find(".carousel-inner"),d=b.find(".item.active").next();if(void 0!=d){carouselNormalization(b);var e=d.attr("data-next-page-url");void 0!=e&&""!=e.trim()&&AjaxGet(e,function(a){jsonres=JSON.parse(a),""!=jsonres.Response.trim()&&c.append(jsonres.Response),d.removeAttr("data-next-page-url"),b.carousel({})})}}),$(".bootstrap-carousel-lazy").each(function(a,b){if(!$(b).hasClass("first-item-loaded")){var c=$(b).find(".carousel-inner");AjaxGet($(b).data("url-firstpage"),function(a){jsonres=JSON.parse(a),""!=jsonres.Next_data_url.trim()&&AjaxGet(jsonres.Next_data_url,function(a){jsonres2=JSON.parse(a),c.append(jsonres2.Response)}),c.append(jsonres.Response),$(b).addClass("first-item-loaded"),c.find("[data-next-page-url]:first").removeAttr("data-next-page-url")})}}),$(".lazy-load").each(function(a,b){AjaxGet($(b).data("url"),function(a){jsonres=JSON.parse(a),$(b).html(jsonres.Response)})}),$(document).mouseup(function(a){$(".hide-on-outside-click").each(function(b,c){$(c).is(a.target)||0!==$(c).has(a.target).length||$(c).remove()})})});var next_data_url,prev_data_url,next_data_cache,prev_data_cache,last_scroll=0,is_loading=0,hide_on_load=!1;!function(a){"use strict";function b(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function c(a,b){var c=d(a,b)?f:e;c(a,b)}var d,e,f;"classList"in document.documentElement?(d=function(a,b){return a.classList.contains(b)},e=function(a,b){a.classList.add(b)},f=function(a,b){a.classList.remove(b)}):(d=function(a,c){return b(c).test(a.className)},e=function(a,b){d(a,b)||(a.className=a.className+" "+b)},f=function(a,c){a.className=a.className.replace(b(c)," ")});var g={hasClass:d,addClass:e,removeClass:f,toggleClass:c,has:d,add:e,remove:f,toggle:c};"function"==typeof define&&define.amd?define(g):a.classie=g}(window),function(a){"use strict";function b(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(a){for(var b=[],c=a.length,e=a[0].length,f=0;f<c;f++)b=b.concat(a[f]);b=d(b);for(var g=[],h=0,i=0;i<c;i++){for(var j=[],k=0;k<e;k++)j.push(b[h]),h++;g.push(j)}return g}function d(a){for(var b,c,d=a.length;d;)c=Math.floor(Math.random()*d--),b=a[d],a[d]=a[c],a[c]=b;return a}function e(a,c){if(this.el=a,this.inner=this.el.querySelector("div"),this.allItems=[].slice.call(this.inner.children),this.allItemsCount=this.allItems.length,this.allItemsCount){this.items=[].slice.call(this.inner.querySelectorAll("figure:not([data-dummy])")),this.itemsCount=this.items.length,this.options=b({},this.options),b(this.options,c),this.current=this.options.start,this._init();var d=this;return{showPhoto:function(a){d._showPhoto.call(d,a)},open:function(){d._open.call(d,!0)},navigate:function(a){d._navigate.call(d,a)}}}}Modernizr.addTest("csstransformspreserve3d",function(){var b,c=Modernizr.prefixed("transformStyle"),d="preserve-3d";return!!c&&(c=c.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()}).replace(/^ms-/,"-ms-"),Modernizr.testStyles("#modernizr{"+c+":"+d+";}",function(d,e){b=a.getComputedStyle?getComputedStyle(d,null).getPropertyValue(c):""}),b===d)});var f={transitions:Modernizr.csstransitions,preserve3d:Modernizr.csstransformspreserve3d},g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},h=g[Modernizr.prefixed("transition")];e.prototype.options={start:0,showNavigation:!0,afterInit:null,afterShowPhoto:null,afterNavigate:null},e.prototype._init=function(){this.currentItem=this.items[this.current],this.options.showNavigation&&this._addNavigation(),this._getSizes(),this._initEvents(),this.options.afterInit&&this.options.afterInit(this)},e.prototype._addNavigation=function(){this.nav=document.createElement("nav");for(var a="",b=0;b<this.itemsCount;++b)a+="<span></span>";this.nav.innerHTML=a,this.el.appendChild(this.nav),this.navDots=[].slice.call(this.nav.children)},e.prototype._open=function(a){var b=this,c=this.el,d=function(){f.transitions&&classie.addClass(c,"photostack-transition")};a?(c.removeEventListener("click",open),classie.removeClass(c,"photostack-start"),d()):(b.openDefault=!0,setTimeout(d,25)),b.started=!0,b._showPhoto(b.current)},e.prototype._initEvents=function(){"true"==this.options.clickToFlip&&this.items.forEach(function(a,c){a.addEventListener("click",function(a){a.preventDefault(),c===b.current&&b._rotateItem()})});var b=this,c=classie.hasClass(this.el,"photostack-start");c?(this._shuffle(),this.el.addEventListener("click",function(){b._open(c)})):this._open(c),this.options.showNavigation&&this.navDots.forEach(function(a,c){a.addEventListener("click",function(){if(c===b.current)b._rotateItem();else{var a=function(){b._showPhoto(c)};b.flipped?b._rotateItem(a):a()}})}),a.addEventListener("resize",function(){b._resizeHandler()})},e.prototype._resizeHandler=function(){function a(){b._resize(),b._resizeTimeout=null}var b=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(a,100)},e.prototype._resize=function(){var a=this,b=function(){a._shuffle(!0)};this._getSizes(),this.started&&this.flipped?this._rotateItem(b):b()},e.prototype._showPhoto=function(a){return!this.isShuffling&&(this.isShuffling=!0,classie.hasClass(this.currentItem,"photostack-flip")&&(this._removeItemPerspective(),this.options.showNavigation&&classie.removeClass(this.navDots[this.current],"flippable")),this.options.showNavigation&&classie.removeClass(this.navDots[this.current],"current"),classie.removeClass(this.currentItem,"photostack-current"),this.current=a,this.currentItem=this.items[this.current],this.options.showNavigation&&classie.addClass(this.navDots[this.current],"current"),this.options.showNavigation&&this.currentItem.querySelector(".photostack-back")&&classie.addClass(this.navDots[a],"flippable"),this._shuffle(),void(this.options.afterShowPhoto&&this.options.afterShowPhoto(this)))},e.prototype._shuffle=function(a){var b=a?1:this.currentItem.getAttribute("data-shuffle-iteration")||1;(b<=0||!this.started||this.openDefault)&&(b=1),this.openDefault&&(classie.addClass(this.currentItem,"photostack-flip"),this.openDefault=!1,this.isShuffling=!1);var d=.5,e=Math.ceil(this.sizes.inner.width/(this.sizes.item.width*d)),g=Math.ceil(this.sizes.inner.height/(this.sizes.item.height*d)),i=e*this.sizes.item.width*d+this.sizes.item.width/2-this.sizes.inner.width,j=g*this.sizes.item.height*d+this.sizes.item.height/2-this.sizes.inner.height,k=i/2,l=j/2,m=35,n=-35,o=this,p=function(){--b;for(var a=[],i=0;i<g;++i)for(var j=a[i]=[],q=0;q<e;++q){var r=q*(o.sizes.item.width*d)-k,s=i*(o.sizes.item.height*d)-l,t=0,u=0;if(o.started&&0===b){var v=o._isOverlapping({x:r,y:s});if(v.overlapping){t=v.noOverlap.x,u=v.noOverlap.y;var w=Math.floor(3*Math.random());switch(w){case 0:t=0;break;case 1:u=0}}}j[q]={x:r+t,y:s+u}}a=c(a);var x=0,y=0,z=0;o.allItems.forEach(function(c,d){x===e-1?(y=y===g-1?0:y+1,x=1):++x;var i=(Math.floor(Math.random()*e),Math.floor(Math.random()*g),a[y][x-1]),j={x:i.x,y:i.y},k=function(){++z,f.transitions&&this.removeEventListener(h,k),z===o.allItemsCount&&(b>0?p.call():(classie.addClass(o.currentItem,"photostack-flip"),o.isShuffling=!1,"function"==typeof o.options.callback&&o.options.callback(o.currentItem)))};o.items.indexOf(c)===o.current&&o.started&&0===b?(o.currentItem.style.WebkitTransform="translate("+o.centerItem.x+"px,"+o.centerItem.y+"px) rotate(0deg)",o.currentItem.style.msTransform="translate("+o.centerItem.x+"px,"+o.centerItem.y+"px) rotate(0deg)",o.currentItem.style.transform="translate("+o.centerItem.x+"px,"+o.centerItem.y+"px) rotate(0deg)",o.currentItem.querySelector(".photostack-back")&&o._addItemPerspective(),classie.addClass(o.currentItem,"photostack-current")):(c.style.WebkitTransform="translate("+j.x+"px,"+j.y+"px) rotate("+Math.floor(Math.random()*(m-n+1)+n)+"deg)",c.style.msTransform="translate("+j.x+"px,"+j.y+"px) rotate("+Math.floor(Math.random()*(m-n+1)+n)+"deg)",c.style.transform="translate("+j.x+"px,"+j.y+"px) rotate("+Math.floor(Math.random()*(m-n+1)+n)+"deg)"),o.started&&(f.transitions?c.addEventListener(h,k):k())})};p.call()},e.prototype._navigate=function(a){var b=this.current,c=this.itemsCount,d=c-1,e=0;"next"==a?e=b<d?b+1:0:"prev"==a&&(e=b>0?b-1:d),this._showPhoto(e),this.options.afterNavigate&&this.options.afterNavigate(this)},e.prototype._getSizes=function(){this.sizes={inner:{width:this.inner.offsetWidth,height:this.inner.offsetHeight},item:{width:this.currentItem.offsetWidth,height:this.currentItem.offsetHeight}},this.centerItem={x:this.sizes.inner.width/2-this.sizes.item.width/2,y:this.sizes.inner.height/2-this.sizes.item.height/2}},e.prototype._isOverlapping=function(a){var b=this.sizes.item.width+this.sizes.item.width/3,c=this.sizes.item.height+this.sizes.item.height/3,d={x:this.sizes.inner.width/2-b/2,y:this.sizes.inner.height/2-c/2},e=this.sizes.item.width,f=this.sizes.item.height;if(!(a.x+e<d.x||a.x>d.x+b||a.y+f<d.y||a.y>d.y+c)){var g=Math.random()<.5,h=Math.floor(Math.random()*(e/4+1)),i=Math.floor(Math.random()*(f/4+1)),j=g?(a.x-d.x+e)*-1-h:d.x+b-(a.x+e)+e+h,k=g?(a.y-d.y+f)*-1-i:d.y+c-(a.y+f)+f+i;return{overlapping:!0,noOverlap:{x:j,y:k}}}return{overlapping:!1}},e.prototype._addItemPerspective=function(){classie.addClass(this.el,"photostack-perspective")},e.prototype._removeItemPerspective=function(){classie.removeClass(this.el,"photostack-perspective"),classie.removeClass(this.currentItem,"photostack-flip")},e.prototype._rotateItem=function(a){if(classie.hasClass(this.el,"photostack-perspective")&&!this.isRotating&&!this.isShuffling){this.isRotating=!0;var b=this,c=function(){f.transitions&&f.preserve3d&&this.removeEventListener(h,c),b.isRotating=!1,"function"==typeof a&&a()};this.flipped?(this.options.showNavigation&&classie.removeClass(this.navDots[this.current],"flip"),f.preserve3d?(this.currentItem.style.WebkitTransform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) rotateY(0deg)",this.currentItem.style.transform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) rotateY(0deg)"):classie.removeClass(this.currentItem,"photostack-showback")):(this.options.showNavigation&&classie.addClass(this.navDots[this.current],"flip"),f.preserve3d?(this.currentItem.style.WebkitTransform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) translate("+this.sizes.item.width+"px) rotateY(-179.9deg)",this.currentItem.style.transform="translate("+this.centerItem.x+"px,"+this.centerItem.y+"px) translate("+this.sizes.item.width+"px) rotateY(-179.9deg)"):classie.addClass(this.currentItem,"photostack-showback")),this.flipped=!this.flipped,f.transitions&&f.preserve3d?this.currentItem.addEventListener(h,c):c()}},a.Photostack=e}(window);